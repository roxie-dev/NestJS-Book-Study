# [3ì¥] ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê´€ë¬¸: ì¸í„°í˜ì´ìŠ¤

# 3.1 ì»¨íŠ¸ë¡¤ëŸ¬

- ì»¨íŠ¸ë¡¤ëŸ¬(Controller)ëŠ” ë“¤ì–´ì˜¤ëŠ” ìš”ì²­(Request)ì„ ë°›ê³  ì²˜ë¦¬ëœ ê²°ê³¼ë¥¼ ì‘ë‹µ(Response)ìœ¼ë¡œ ëŒë ¤ì£¼ëŠ” ì¸í„°í˜ì´ìŠ¤ ì—­í• ì„ í•œë‹¤.
- ì—”ë“œí¬ì¸íŠ¸ ë¼ìš°íŒ… ë©”ì»¤ë‹ˆì¦˜ì„ í†µí•´ ê° ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë°›ì„ ìˆ˜ ìˆëŠ” ìš”ì²­ì„ ë¶„ë¥˜í•œë‹¤.

> ğŸ’¡ **ì—”ë“œí¬ì¸íŠ¸ ë¼ìš°íŒ… ë©”ì»¤ë‹ˆì¦˜ì´ë€?**
>
> - í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì´ ì˜¬ë°”ë¥¸ ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë©”ì„œë“œë¡œ ì „ë‹¬ë˜ëŠ” ê³¼ì •.
> - "ì–´ë–¤ URLì— ì–´ë–¤ ìš”ì²­ì´ ì˜¤ë©´, ì–´ë–¤ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì–´ë–¤ ë©”ì„œë“œë¡œ ì²˜ë¦¬í• ì§€ ê²°ì •í•˜ëŠ” ë¡œì§â€.
> - NestJSê°€ `@Controller()`, `@Get()`, `@Post()` ë“±ì„ ë¶„ì„í•˜ì—¬ ì ì ˆí•œ ë©”ì„œë“œë¥¼ ì‹¤í–‰.
> - Reflect ë©”íƒ€ë°ì´í„°ì™€ Express.js ë¼ìš°í„°ë¥¼ ì‚¬ìš©í•´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ë§¤ì¹­.
> - ë™ì  ë¼ìš°íŒ…(`:id` ë“±)ë„ ìë™ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥.

### ì»¨íŠ¸ë¡¤ë¡œ ìƒì„±

```bash
# Users ì»¨íŠ¸ë¡¤ëŸ¬ ìƒì„±
$ nest g controller Users

# Nest êµ¬ì„± ìš”ì†Œì— ëŒ€í•œ ì•½ì–´ í™•ì¸
$ nest -h

# CRUD ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ ìƒì„±
$ nest g resource [name]
```

<p align="center">
 <img width="250" src="../../assets/kmj/1/image.png" >
  <p align="center"><em> > CRUD ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ë¡œ ìƒì„± í–ˆì„ ë•Œ</em></p>
  </p>

<br />

# 3.1.1 ë¼ìš°íŒ…

```tsx
// app.controller.ts

import { Confroller, GEt } from '@nestjs/common';
import { AppService } from './app.service';

@Controller() // ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ì„ì„ ëª…ì‹œ. ë£¨íŠ¸ ê²½ë¡œ('/')ê°€ ìƒëµë¨.
export class AppController {
    constructor(pricate readonly appService: AppService) {}

    @Get('/hello') // ë©”ì„œë“œ ë°ì½”ë ˆì´í„°
    getHello(): string {
        return this.appService.getHello();
    }
}
```

```tsx
ğŸ’© ìš”ì²­ : http://localhost:3000/

{
    "statusCode": 404,
    "message": "Cannot GET /",
    "error": "Not Found"
}

ğŸŒŸ ìš”ì²­ : http://localhost:3000/hello
```

- `getHello()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” `@Get('/hello')` ë°ì½”ë ˆì´í„°ê°€ ì‚¬ìš©ë˜ì—ˆê¸° ë•Œë¬¸ì— `/hello` ê²½ë¡œë¡œ ìš”ì²­í•´ì•¼ í•œë‹¤.
- ë£¨íŠ¸ ê²½ë¡œ('/')ì—ëŠ” ì–´ë–¤ í•¸ë“¤ëŸ¬ë„ ì •ì˜ë˜ì–´ ìˆì§€ ì•Šì•„ 404 ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ë§Œ, `/hello` ê²½ë¡œë¡œ ìš”ì²­í•˜ë©´ `getHello()` í•¨ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œëœë‹¤.

# 3.1.2 ì™€ì¼ë“œ ì¹´ë“œ ì‚¬ìš©

- ë¼ìš°íŒ… íŒ¨ìŠ¤ëŠ” ì™€ì¼ë“œ ì¹´ë“œë¥¼ ì´ìš©í•˜ì—¬ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
- ë‹¤ì–‘í•œ ìƒí™©ì—ì„œ ìœ ì—°í•œ íŒ¨í„´ ë§¤ì¹­ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” ê¸°ëŠ¥ì´ë‹¤.
- ì—¬ëŸ¬ ìš”ì²­ì„ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•  ë•Œ ë§¤ìš° ìœ ìš©í•˜ë‹¤.

```tsx
@Controller("api")
export class AppController {
  @Get("users*")
  getAllUsers() {
    // usersë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ê²½ë¡œë¥¼ ì²˜ë¦¬
    // ì˜ˆ: /api/users, /api/users/active, /api/users/123 ë“±
    return "This route uses a wildcard";
  }
}
```

### ğŸš¨ ì£¼ì˜ ì‚¬í•­

- ì™€ì¼ë“œì¹´ë“œ ì‚¬ìš© ì‹œ ë¼ìš°íŠ¸ ìˆœì„œê°€ ì¤‘ìš”í•˜ë¯€ë¡œ, êµ¬ì²´ì ì¸ ë¼ìš°íŠ¸ë¥¼ ì™€ì¼ë“œì¹´ë“œ ë¼ìš°íŠ¸ë³´ë‹¤ ë¨¼ì € ì„ ì–¸í•´ì•¼ í•œë‹¤.
- ë„ˆë¬´ ê´‘ë²”ìœ„í•œ ì™€ì¼ë“œì¹´ë“œëŠ” ì„±ëŠ¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤.
- ë””ë²„ê¹…ì´ ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì ì ˆíˆ ë¬¸ì„œí™”í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

### êµ¬ì²´ì ì¸ ë¼ìš°íŠ¸ë¥¼ ì™€ì¼ë“œì¹´ë“œ ë¼ìš°íŠ¸ë³´ë‹¤ ë¨¼ì € ì„ ì–¸í•˜ëŠ” ì˜ˆì œ

```tsx
// products.controller.ts

import { Controller, Get, Param } from "@nestjs/common";

@Controller("products")
export class ProductsController {
  // êµ¬ì²´ì ì¸ ë¼ìš°íŠ¸ê°€ ë¨¼ì € ì„ ì–¸ë¨
  @Get("featured")
  getFeaturedProducts() {
    return { message: "íŠ¹ë³„ ìƒí’ˆ ëª©ë¡ì…ë‹ˆë‹¤" };
  }

  // íŠ¹ì • IDë¥¼ ê°€ì§„ ìƒí’ˆì„ ìœ„í•œ êµ¬ì²´ì ì¸ ë¼ìš°íŠ¸
  @Get(":id/details")
  getProductDetails(@Param("id") id: string) {
    return { message: `ìƒí’ˆ ID ${id}ì˜ ìƒì„¸ ì •ë³´ì…ë‹ˆë‹¤` };
  }

  // ì™€ì¼ë“œì¹´ë“œ ë¼ìš°íŠ¸ëŠ” ë” êµ¬ì²´ì ì¸ ë¼ìš°íŠ¸ ë’¤ì— ì„ ì–¸
  @Get(":id*")
  getProductWildcard(@Param("id") id: string) {
    return { message: `ì™€ì¼ë“œì¹´ë“œ ê²½ë¡œë¡œ ìƒí’ˆ ID ${id}ì— ì ‘ê·¼í–ˆìŠµë‹ˆë‹¤` };
  }

  // ê°€ì¥ ì¼ë°˜ì ì¸ ì™€ì¼ë“œì¹´ë“œ ë¼ìš°íŠ¸ëŠ” ë§ˆì§€ë§‰ì— ì„ ì–¸
  @Get("*")
  getAllProductRoutes() {
    return { message: "ëª¨ë“  ìƒí’ˆ ê´€ë ¨ ê²½ë¡œë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤" };
  }
}

// app.module.ts
@Module({
  imports: [
    // êµ¬ì²´ì ì¸ ê²½ë¡œë¥¼ ì²˜ë¦¬í•˜ëŠ” ëª¨ë“ˆì„ ë¨¼ì € ê°€ì ¸ì˜µë‹ˆë‹¤
    ProductsModule,
    UsersModule,
    // ì™€ì¼ë“œì¹´ë“œ ë¼ìš°íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ëª¨ë“ˆì€ ë‚˜ì¤‘ì— ê°€ì ¸ì˜µë‹ˆë‹¤
    FallbackModule,
  ],
})
export class AppModule {}
```

## â“ ì™€ì¼ë“œ ì¹´ë“œëŠ” ì‹¤ë¬´ì—ì„œ ì–´ë–¤ ê²½ìš°ì— ì‚¬ìš©ë ê¹Œ?

### 1. API ê²Œì´íŠ¸ì›¨ì´ ë¼ìš°íŒ…

- API ê²Œì´íŠ¸ì›¨ì´ ë˜ëŠ” í”„ë¡ì‹œ ì„œë²„ë¥¼ êµ¬ì¶•í•  ë•Œ, ëª¨ë“  API ìš”ì²­ì„ íŠ¹ì • ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…í•˜ëŠ” ë° ì™€ì¼ë“œì¹´ë“œ ë¼ìš°íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ì´ëŸ° êµ¬ì„±ì€ ë‹¤ìˆ˜ì˜ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ê°€ ì—°ë™ë˜ëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œ ìœ ìš©í•˜ë‹¤.

```tsx
@Controller("api")
export class ApiController {
  @Get("*")
  handleApiRequests(@Req() req: Request, @Res() res: Response) {
    const apiUrl = `http://backend-service${req.url}`;
    this.httpService.get(apiUrl).subscribe((response) => {
      res.send(response.data);
    });
  }
}
```

- ì´ ì½”ë“œëŠ” ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  `/api` ê²½ë¡œ ìš”ì²­ì„ `backend-service`ë¡œ í”„ë¡ì‹œí•œë‹¤.

### 2. 404 ì—ëŸ¬ í•¸ë“¤ë§

- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ë¡œì— ëŒ€í•œ ì ‘ê·¼ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë§ˆì§€ë§‰ ë¼ìš°íŠ¸ë¡œ ì™€ì¼ë“œì¹´ë“œë¥¼ ì„¤ì •í•˜ì—¬ ëª¨ë“  ë¯¸ì²˜ë¦¬ ìš”ì²­ì„ ìº¡ì²˜í•  ìˆ˜ ìˆë‹¤.

```tsx
@Controller("*")
export class FallbackController {
  @Get()
  handleFallback() {
    return "This page does not exist.";
  }
}
```

- ì´ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì–´ë–¤ ë¼ìš°íŠ¸ì—ë„ ë§¤ì¹˜ë˜ì§€ ì•ŠëŠ” ëª¨ë“  ìš”ì²­ì„ ì²˜ë¦¬í•˜ë©°, ì‚¬ìš©ìì—ê²Œ 404 í˜ì´ì§€ê°€ ì—†ìŒì„ ì•Œë¦°ë‹¤.

### 3. ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§

- ëª¨ë“  ìš”ì²­ì— ëŒ€í•œ ë¡œê¹…ì„ êµ¬í˜„í•˜ë ¤ë©´ ì™€ì¼ë“œì¹´ë“œ ë¼ìš°íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  ìš”ì²­ì„ ë¡œê·¸ì— ê¸°ë¡í•  ìˆ˜ ìˆë‹¤.

```tsx
@Controller("*")
export class LoggingController {
  @Get()
  logRequest(@Req() req: Request) {
    console.log(`Incoming request for ${req.url}`);
    // ë‹¤ë¥¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ìš”ì²­ì„ ì „ë‹¬í•˜ê±°ë‚˜ ì²˜ë¦¬
  }
}
```

- ì´ ì„¤ì •ì€ ê°œë°œ ì¤‘ ë˜ëŠ” ìš´ì˜ í™˜ê²½ì—ì„œ ëª¨ë“  ìš”ì²­ì„ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤.

<br />

# 3.1.3 ìš”ì²­ ê°ì²´

- `@Req() request` : ì „ì²´ ìš”ì²­ ê°ì²´ì— ì ‘ê·¼.
- `@Param('id')`: URLì—ì„œ ê²½ë¡œ ë³€ìˆ˜ ì¶”ì¶œ (ì˜ˆ: /users/123ì—ì„œ 123)
- `@Query('name')`: URL ì§ˆì˜ ë³€ìˆ˜ ì¶”ì¶œ (ì˜ˆ: /users?name=ê¸¸ë™ì—ì„œ 'ê¸¸ë™')
- `@Body()`: POST ìš”ì²­ì˜ ë³¸ë¬¸ ë°ì´í„° ì¶”ì¶œ (ì˜ˆ: JSON ë°ì´í„°)

```tsx
// ì»¨íŠ¸ë¡¤ëŸ¬ íŒŒì¼ (ì˜ˆ: users.controller.ts)
import {
  Controller,
  Get,
  Post,
  Body,
  Param,
  Query,
  Req,
  Res,
} from "@nestjs/common";
import { Request, Response } from "express";

@Controller("users")
export class UsersController {
  // ê¸°ë³¸ GET ìš”ì²­ ì²˜ë¦¬
  @Get()
  getAllUsers(@Req() request: Request) {
    console.log("ìš”ì²­ URL:", request.url); // ìš”ì²­ ì£¼ì†Œ
    console.log("ìš”ì²­ ë°©ë²•:", request.method); // ìš”ì²­ ë°©ë²• (GET)
    console.log("ìš”ì²­ í—¤ë”:", request.headers); // ìš”ì²­ ë¨¸ë¦¬ë§

    return { message: "ëª¨ë“  ì‚¬ìš©ì ì •ë³´ì…ë‹ˆë‹¤!" };
  }

  // ê²½ë¡œ íŒŒë¼ë¯¸í„° ì‚¬ìš©
  @Get(":id")
  getUserById(@Param("id") id: string, @Req() request: Request) {
    console.log(`ì‚¬ìš©ì ID ${id}ì— ëŒ€í•œ ì •ë³´ ìš”ì²­ì´ ì™”ì–´ìš”!`);
    return { userId: id, name: "í™ê¸¸ë™" };
  }

  // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì‚¬ìš©
  @Get("search")
  searchUsers(@Query("name") name: string) {
    console.log(`ì´ë¦„ì´ ${name}ì¸ ì‚¬ìš©ìë¥¼ ì°¾ê³  ìˆì–´ìš”!`);
    return { result: [`${name}1`, `${name}2`] };
  }

  // POST ìš”ì²­ìœ¼ë¡œ ë°ì´í„° ì „ì†¡
  @Post()
  createUser(@Body() userData: any, @Req() request: Request) {
    console.log("ìƒˆ ì‚¬ìš©ì ì •ë³´:", userData); // ìš”ì²­ ë³¸ë¬¸ ë°ì´í„°
    console.log("ìš”ì²­ í—¤ë”ì˜ íƒ€ì…:", request.headers["content-type"]); // ì–´ë–¤ í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ê°€ ì™”ëŠ”ì§€

    return {
      message: "ìƒˆ ì‚¬ìš©ìê°€ ìƒì„±ë˜ì—ˆì–´ìš”!",
      user: userData,
    };
  }

  // ì§ì ‘ ì‘ë‹µ ê°ì²´ ë‹¤ë£¨ê¸°
  @Get("download")
  downloadFile(@Res() response: Response) {
    // ì‘ë‹µ ê°ì²´ë¥¼ ì§ì ‘ ì¡°ì‘
    response.setHeader("Content-Type", "text/plain");
    response.send("ì—¬ê¸°ì— íŒŒì¼ ë‚´ìš©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤!");
  }
}
```

## ğŸ“¨ Clientì—ì„œ ìš”ì²­

```json
GET ìš”ì²­: ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:3000/users ì ‘ì†
ê²½ë¡œ íŒŒë¼ë¯¸í„°: http://localhost:3000/users/123 ì ‘ì†
ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°: http://localhost:3000/users/search?name=ê¸¸ë™ ì ‘ì†
POST ìš”ì²­: Postmanì´ë‚˜ fetch APIë¡œ ë³¸ë¬¸ì— JSON ë°ì´í„° í¬í•¨í•´ ìš”ì²­
```

<br />

# 3.1.4 ì‘ë‹µ

- @Resë°ì»¤ë ˆì´í„°ë¥¼ ì´ìš©í•´ì„œ Expressì‘ë‹µ ê°ì²´ë¥¼ ë‹¤ë£° ìˆ˜ ìˆë‹¤.

```tsx
import { Responce } from 'exporess';

@Get()
findAll(@Res() res: Responce) {
    const users = this.userService.findAll();

    return res.status(200).send(users);
}
```

## ì‘ë‹µ ìƒíƒœ ì½”ë“œë¥¼ ë³€ê²½í•˜ë ¤ë©´ ?

- `@HttpCode`

```tsx
import { HttpCode } from '@nestjs/common';

@HttpCode(202)
@Patch(':id')
@update(@Param('id) id: string, @Body() updateUserDto: UpdateUserDto) {
    return this.usersService.update(+id, updateUserDto);
}
```

- `Bad Request` ì˜ˆì™¸ ì²˜ë¦¬

```tsx
import { BadRequestException } from '@nestjs/common';

@Get(':id')
@findOne(@Param('id) id: string) {
    if(+id < 1) {
        throw new BadRequestException('idëŠ” 0ë³´ë‹¤ í° ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
    }

    return this.usersService.findOne(+id);
}
```

```bash
$ curl -X GET http://localhost:3000/users/0
{
    "statusCode": 400,
    "message": "idëŠ” 0ë³´ë‹¤ í° ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤.",
    "error": "Bad Request"
}
```

<br />

# 3.1.5 í—¤ë”

- NestëŠ” ì‘ë‹µ í—¤ë”ë¥¼ ìë™ìœ¼ë¡œ êµ¬ì„±í•´ì¤€ë‹¤.
- ì»¤ìŠ¤í…€ í—¤ë”ë¥¼ ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´ @Header ë°ì»¤ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```bash
import { Header } from '@nestjs/common';

@Header('Custom', 'Test Header')
@Get(':id')
findOneWithHeader(@Param('id') id: string) {
    return this.usersService.findOne(+id);
}
```

```bash
$ curl -X GET http://localhost:3000/users/1 -v
Note: Unnecessary use of -X or --request, GET is already inferred.
*    Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 3000 (#0)
> GET /users/1 HTTP1.1
> Host: localhost:3000
> User-Agent: curl/.64.1
> Accept: */*
>
< HTTP/1.1 200 OK
< X-Powered-By: Express
< Custom: Test Header
< Content-Type: text/html; charset=utf-8
```

<br />

# 3.1.6 ë¦¬ë””ë ‰ì…˜

- ìš”ì²­ì„ ë³´ë‚¸ í´ë¼ì´ì–¸íŠ¸ë¥¼ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ê³  ì‹¶ì€ ê²½ìš° ì‚¬ìš©í•œë‹¤.
- @Redirect ë°ì»¤ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ êµ¬í˜„ì´ ê°€ëŠ¥í•Ÿ.

```tsx
import { Redirect } from '@nestjs/common';

@Redirect('https://nests.com', 301)
@Get(':id')
findOne(@Param('id') id: string) {
    return this.usersService.findOne(+id);
}
```

- ìš”ì²­

```bash
$ curl -X GET http://localhost:3000/users/1 -v
Note: Unnecessary use of -X or --request, GET is already inferred.
*    Trying ::1...
* TCP_NODELAY set
* Connected to localhost (::1) port 3000 (#0)
> GET /users/1 HTTP1.1
> Host: localhost:3000
> User-Agent: curl/.64.1
> Accept: */*
>
< HTTP/1.1 301 Moved Permanently
< X-Powered-By: Express
< Custom: Test Header
< Location: https://nestjs.com
```

<br />

# 3.1.7 ë¼ìš°íŠ¸ ë§¤ê°œë³€ìˆ˜

- `ë¼ìš°íŠ¸ ë§¤ê°œë³€ìˆ˜`ëŠ” `íŒ¨ìŠ¤ ë§¤ê°œë³€ìˆ˜`ë¼ê³ ë„ í•œë‹¤.

```tsx
http://localhost:3000/users/1
```

- 1ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì€ ìœ ì €IDë¡œ, ë™ì ìœ¼ë¡œ êµ¬ì„±ëœë‹¤. (ê²½ë¡œë¥¼ êµ¬ì„±í•˜ëŠ” ë§¤ê°œë³€ìˆ˜)
- ì „ë‹¬ë°›ì€ ë§¤ê°œë³€ìˆ˜ëŠ” í•¨ìˆ˜ì•ˆì—ì„œ `@Param`ë°ì»¤ë ˆì´í„°ë¡œ ì£¼ì…ë°›ì„ ìˆ˜ ìˆë‹¤.

## ë¼ìš°íŠ¸ ë§¤ê°œë³€ìˆ˜ë¥¼ ì „ë‹¬ ë°›ëŠ” ë°©ë²•

### 1. ê°ì²´ë¡œ ë°›ëŠ” ë°©ë²•

- paramsì˜ íƒ€ì…ì´ anyì´ ë˜ì–´ ê¶Œì¥í•˜ì§€ ì•Šì§€ë§Œ ë¼ìš°íŠ¸ ë§¤ê°œë³€ìˆ˜ì˜ íƒ€ì…ì´ í•­ìƒ ;stringì´ê¸° ë•Œë¬¸ì— ëª…ì‹œì ìœ¼ë¡œ `{ [key: string]: string }`ì„ ì§€ì •í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```tsx
@Delete(':userId/memo/:memoId)
deleteUserMemo(@Param() params: { [key: string]: string }) {
    return `userId: ${params.userId}, memoId: ${params.memoId}`;
}
```

### 2. ë¼ìš°íŒ… ë§¤ê°œë³€ìˆ˜ë¥¼ ë”°ë¡œ ë°›ëŠ” ë°©ë²•

- ì¼ë°˜ì ì¸ ë°©ë²•ìœ¼ë¡œ , ë¼ìš°íŒ… ë§¤ê°œë³€ìˆ˜ë¥¼ ë”°ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.
- `REST API`ë¥¼ êµ¬ìƒí•  ë•ŒëŠ” ë¼ìš°íŒ… ë§¤ê°œë³€ìˆ˜ì˜ ê°œìˆ˜ê°€ ë§ì§€ ì•Šê²Œ ì„¤ê³„í•˜ê¸° ë•Œë¬¸ì— ë”°ë¡œ ë°›ì•„ë„ ì½”ë“œê°€ ë§ì´ ê¸¸ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤.

```tsx
@Delete(':userId/memo/:memoId)
deleteUserMemo(
    @Param('userId') userId: string,
    @Param('memoId') memoId: string,
) {
    return `userId: ${userId}, memoId: ${memoId}`;
}
```

<br />

# 3.1.8 í•˜ìœ„ ë„ë©”ì¸ ë¼ìš°íŒ…

> ğŸ’¡ **í•˜ìœ„ ë„ë©”ì¸ì´ë€?**  
> â€¢ google.com(ì¸í„°ë„· ì£¼ì†Œ:ë„ë©”ì¸)ì•ì— ë­”ê°€ ë¶™ëŠ” ê²ƒ.  
> â€¢ `mail.google.com`, `docs.google.com`

<p align="center">
<img width="280" src="../../assets/kmj/1/Group_237620.png" > </p>

- `google.com` ì§‘ ì•ˆì— ì—¬ëŸ¬ ê°œì˜ `ë°©(mail, docs)`ì´ ìˆë‹¤ê³  ìƒê°í•´ ë³´ì.
- "ë°©"ë§ˆë‹¤ ë‹¤ë¥¸ ê¸°ëŠ¥ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
  - `api.example.com` â†’ API ì„œë²„
  - `admin.example.com` â†’ ê´€ë¦¬ì í˜ì´ì§€
  - `user.example.com` â†’ ì‚¬ìš©ì ì „ìš© í˜ì´ì§€
- ì´ë ‡ê²Œ ì£¼ì†Œê°€ ë‹¤ë¥´ë©´, NestJSê°€ **"ì–´ëŠ ë°©ìœ¼ë¡œ ë“¤ì–´ì™”ëŠ”ì§€"** í™•ì¸í•˜ê³  ë‹¤ë¥¸ ê¸°ëŠ¥ì„ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤.

## NestJSì—ì„œ í•˜ìœ„ ë„ë©”ì¸ ë¼ìš°íŒ… í•˜ê¸°

- nestjsê°€ `sub`ìë¦¬ì— ë“¤ì–´ì˜¤ëŠ” ë„¤ì„ì„ ì°¾ì•„ì„œ í•´ë‹¹í•˜ëŠ” ë°©ìœ¼ë¡œ ì•ˆë‚´ í•´ ì¤€ë‹¤.

```tsx
import { Controller, Get, Req, HostParam } from "@nestjs/common";
import { Request } from "express";

@Controller({ host: ":sub.example.com" }) // â† í•˜ìœ„ ë„ë©”ì¸ ë°›ê¸° (ì˜ˆ: student.example.com, teacher.example.com)
export class SubdomainController {
  @Get()
  handleSubdomain(@HostParam("sub") subdomain: string, @Req() req: Request) {
    return `ì•ˆë…•! ë„ˆëŠ” [${subdomain}.example.com]ì—ì„œ ì™”êµ¬ë‚˜!`;
  }
}
```

<br />

# 3.1.9 í˜ì´ë¡œë“œ ë‹¤ë£¨ê¸°

- POST, PUT, PATCH ìš”ì²­ì€ ë³´í†µ ì²˜ë¦¬ì— í•„ìš”í•œ í˜ì´ë¡œë“œ(payload)ë°ì´í„°ë¥¼ í•¨ê»˜ ì‹¤ì–´ ë³´ë‚´ëŠ” ë°, ì´ ë°ì´í„°ë¥¼ ë³¸ë¬¸(body)ì´ë¼ê³  í•œë‹¤.
- nestJSëŠ” ë°ì´í„° ì „ì†¡ ê°ì²´(data transfer object, DTO)ê°€ êµ¬í˜„ë˜ì–´ ìˆì–´ ë³¸ë¶„ì„ ì‰½ê²Œ ë‹¤ë£° ìˆ˜ ìˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸

```tsx
const payload = {
  name: "ì´ˆì½”ë§› ì¿ í‚¤",
  age: 7,
};

const response = await axios.post("http://localhost:3000/cookies", payload);
console.log("ì„œë²„ ì‘ë‹µ:", response.data);
```

- ì„œë²„

```tsx
import { Controller, Post, Body } from "@nestjs/common";

@Controller("cookies")
export class CookieController {
  @Post()
  createCookie(@Body() data: { name: string; age: number }) {
    console.log("ë°›ì€ ë°ì´í„°:", data);
    return { message: `${data.name} ì¿ í‚¤ ì €ì¥ ì™„ë£Œ!` };
  }
}
```

<br />

# 3.2 ìœ ì € ì„œë¹„ìŠ¤ì˜ ì¸í„°í˜ì´ìŠ¤

- ìœ ì € ì„œë¹„ìŠ¤ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í•˜ê³  ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ êµ¬í˜„í•´ë³¸ë‹¤.
- ë¨¼ì €, ì™¸ë¶€(í”„ë¡ íŠ¸)ì—ì„œ 4ê°€ì§€ì˜ ìš”ì²­ì„ ë°›ì•„ ì²˜ë¦¬ í•œë‹¤.
- ê° ìš”ì²­ì— ëŒ€í•œ ì¸í„°í˜ì´ìŠ¤

<table>
 <thead>
   <tr>
     <th>ê¸°ëŠ¥</th>
     <th>ì—”ë“œí¬ì¸íŠ¸</th>
     <th>ë³¸ë¬¸ ë°ì´í„° ì˜ˆ (JSON)</th>
     <th>íŒ¨ìŠ¤ ë§¤ê°œë³€ìˆ˜</th>
     <th>ì‘ë‹µ</th>
   </tr>
 </thead>
 <tbody>
   <tr>
     <td>íšŒì›ê°€ì…</td>
     <td>POST /users</td>
     <td>
       {<br>
       "name": "YOUR_NAME",<br>
       "email": "YOUR_EMAIL@gmail.com",<br>
       "password": "PASSWORD"<br>
       }
     </td>
     <td></td>
     <td>201</td>
   </tr>
   <tr>
     <td>ì´ë©”ì¼ ì¸ì¦</td>
     <td>POST /users/email-verify</td>
     <td>
       {<br>
       "signupVerifyToken": "ì„ì˜ì˜ ë¬¸ìì—´"<br>
       }
     </td>
     <td></td>
     <td>201<br>ì•¡ì„¸ìŠ¤ í† í°</td>
   </tr>
   <tr>
     <td>ë¡œê·¸ì¸</td>
     <td>POST /users/login</td>
     <td>
       {<br>
       "email": "YOUR_EMAIL@gmail.com",<br>
       "password": "PASSWORD"<br>
       }
     </td>
     <td></td>
     <td>201<br>ì•¡ì„¸ìŠ¤ í† í°</td>
   </tr>
   <tr>
     <td>íšŒì› ì •ë³´ ì¡°íšŒ</td>
     <td>GET /user/:id</td>
     <td></td>
     <td>id: ìœ ì € ìƒì„± ì‹œ ë§Œë“¤ì–´ì§„ ìœ ì € ID. ì´ë©”ì¼ì´ ì•„ë‹ˆë¼ ì„ì˜ì˜ ë¬¸ìì—´</td>
     <td></td>
   </tr>
 </tbody>
</table>

## ìœ ì € ì»¨íŠ¸ë¡¤ëŸ¬

```tsx
// users.controller.ts

import { Body, Controller, Get, Param, Post, Query } from "@nestjs/common";
import { CreateUserDto } from "./dto/create-user.dto";
import { UserLoginDto } from "./dto/user-login.dto";
import { VerifyEmailDto } from "./dto/verifye-email.dto";
import { UserInfo } from "./UserInfo";

@Controller("users")
export class UserController {
  @Post()
  async create(@Body() dto: CreateUserDto): Promise<void> {
    console.log(dto);
  }

  @Post("/email-verify")
  // @Query: urlì— í¬í•¨ë˜ì–´ ì „ë‹¬ë˜ëŠ” ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜.
  async verifyEmail(@Query() dto: VerifyEmailDto): Promise<void> {
    console.log(dto);
    return;
  }

  @Post("/login")
  // UserLoginDto :  ìœ ì €ê°€ ì…ë ¥í•œ ë°ì´í„°ëŠ” ë³¸ë¬¸ìœ¼ë¡œ ì „ë‹¬ëœë‹¤.
  async login(@Body() dto: UserLoginDto): Promise<string> {
    console.log(dto);
    return;
  }

  @Get("/:id")
  async getUserInfo(@Param("id") userId: string): Promise<UserInfo> {
    console.log(userId);
    return;
  }
}
```

> ğŸ’¡ **ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë° (aspect-oriented programming, AOP)**  
> â€¢ ìœ íš¨ì„± ê²€ì‚¬, ë¡œê¹…, ë³´ì•ˆ, íŠ¸ëœì­ì…˜ê³¼ ê°™ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ë°˜ì— ê±¸ì³ ì œê³µí•´ì•¼ í•˜ëŠ” ê³µí†µ ìš”ì†Œë¥¼ `íš¡ë‹¨ê´€ì‹¬ì‚¬(cross-cutting concern)`ë¼ê³  í•œë‹¤.  
> â€¢ íš¡ë‹¨ê´€ì‹¬ì‚¬ë¥¼ ë”°ë¡œ ë¶„ë¦¬í•˜ì§€ ì•Šê³  ì‚¬ìš©í•˜ë©´ ì‘ì§‘ë„ê°€ ë–¨ì–´ì§€ê³  ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µê²Œ ë˜ëŠ”ë° ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„ì„ ì‚¬ìš©í•œë‹¤.  
> â€¢ Nestì—ì„œ ëŒ€í‘œì ì¸ ì»´í¬ë„ŒíŠ¸ë¡œ `ì¸í„°ì…‰í„°(interceptor)`ê°€ ìˆë‹¤.  
> â€¢ NestëŠ” ì „ì—­ìœ¼ë¡œ ì ìš©í•˜ì§€ ì•Šê³  íŠ¹ì • ì»´í¬ë„ŒíŠ¸ì—ì„œë§Œ ì ìš©í•  ë•Œì—ëŠ” ë°ì»¤ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ AOPë¥¼ êµ¬í˜„í•œë‹¤.
