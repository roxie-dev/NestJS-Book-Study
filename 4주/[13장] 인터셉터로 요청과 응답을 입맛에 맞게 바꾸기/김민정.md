# [13μ¥] μΈν„°μ…‰ν„°λ΅ μ”μ²­κ³Ό μ‘λ‹µμ„ μ…λ§›μ— λ§κ² λ°”κΎΈκΈ°

# 13.1 μΈν„°μ…‰ν„°

μΈν„°μ…‰ν„°Interceptorλ” μ”μ²­κ³Ό μ‘λ‹µμ„ κ°€λ΅μ±„μ„ λ³€ν•μ„ κ°€ν•  μ μλ” μ»΄ν¬λ„νΈμ΄λ‹¤.

<p align="center">
 <img  src="../../assets/kmj/4/4-2.png" > 
 <p align="center"><em> > μ¶μ² : nestjs κ³µμ‹ ν™νμ΄μ§€</em></p>
  </p> 
  
## β™οΈ μΈν„°μ…‰ν„°λ¥Ό μ΄μ©ν• κΈ°λ¥ μν–‰

- λ©”μ„λ“ μ‹¤ν–‰ μ „/ν›„ μ¶”κ°€ λ΅μ§μ„ λ°”μΈλ”©
- ν•¨μμ—μ„ λ°ν™λ κ²°κ³Όλ¥Ό λ³€ν™
- ν•¨μμ—μ„ λμ Έμ§„ μμ™Έλ¥Ό λ³€ν™
- κΈ°λ³Έ κΈ°λ¥μ λ™μ‘μ„ ν™•μ¥
- νΉμ • μ΅°κ±΄μ— λ”°λΌ κΈ°λ¥μ„ μ™„μ „ν μ¬μ •μ(ex : μΊμ‹±)

μΈν„°μ…‰ν„°λ” λ―Έλ“¤μ›¨μ–΄μ™€ μν–‰ν•λ” μΌμ΄ λΉ„μ·ν•μ§€λ§, μν–‰ μ‹μ μ— μ°¨μ΄κ°€ μλ‹¤.

## π“ λ―Έλ“¤μ›¨μ–΄ vs μΈν„°μ…‰ν„°: ν•µμ‹¬ λΉ„κµ

| ν•­λ©      | λ―Έλ“¤μ›¨μ–΄ (`Middleware`)        | μΈν„°μ…‰ν„° (`Interceptor`)              |
| --------- | ------------------------------ | ------------------------------------- |
| μ„μΉ      | HTTP μ”μ²­κ³Ό λΌμ°ν„° μ²λ¦¬ μ‚¬μ΄   | μ»¨νΈλ΅¤λ¬ ν•Έλ“¤λ¬ νΈμ¶ μ „/ν›„            |
| λ€μƒ      | Express κΈ°λ° μ”μ²­ νλ¦„         | Nestμ λ©”μ„λ“ λ‹¨μ„ νλ¦„               |
| μ‹¤ν–‰ μ‹μ  | μ»¨νΈλ΅¤λ¬ **μ΄μ „**              | μ»¨νΈλ΅¤λ¬ **μ§μ „/μ§ν›„**                |
| μ‘λ‹µ μ ‘κ·Ό | β μ‘λ‹µμ„ μ΅°μ‘ν•λ” λ° μ ν•μ    | β… μ‘λ‹µμ„ μ‰½κ² κ°€κ³µ/λ³€ν™ κ°€λ¥         |
| μ”μ²­ μμ • | β… μ”μ²­(req) λ³€κ²½ κ°€λ¥         | β… μ”μ²­(context)λ„ λ³€κ²½ κ°€λ¥          |
| μ—λ¬ μ²λ¦¬ | β μ§μ ‘ μμ™Έ μ²λ¦¬ μ–΄λ ¤μ›€       | β… try-catch ν¬ν•¨λ νλ¦„ μ μ–΄ κ°€λ¥    |
| μ£Ό μ©λ„   | μΈμ¦, λ΅κΉ…, μ”μ²­ λ³€ν™, CORS λ“± | μ‘λ‹µ κ°€κ³µ, μΊμ‹±, νΈλμ­μ… λν•‘ λ“±     |
| μ„ μ–Έ λ°©μ‹ | `configure()` μ•μ—μ„ λ“±λ΅      | `@Injectable() + @UseInterceptors()`  |
| μ μ© λ²”μ„ | μ „μ—­ λλ” κ²½λ΅ κΈ°μ¤€            | μ „μ—­, μ»¨νΈλ΅¤λ¬, λ©”μ„λ“ λ‹¨μ„ λ¨λ‘ κ°€λ¥ |

```tsx
// logging.interceptor.ts
import {
  Injectable,
  NestInterceptor,
  ExecutionContext,
  CallHandler,
} from '@nestjs/common';
import { Observable, tap } from 'rxjs';

@Injectable()
export class LoggingInterceptor implements NestInterceptor {
  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {
    const now = Date.now();
    return next.handle().pipe(
      tap(() => console.log(`μ”μ²­ μ²λ¦¬ μ‹κ°„: ${Date.now() - now}ms`)),
    );
  }
}

// controller.ts
import { UseInterceptors } from '@nestjs/common';

@UseInterceptors(LoggingInterceptor)
@Get()
findAll() {
  return this.service.getAll();
}
```
