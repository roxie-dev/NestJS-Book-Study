# [9ì¥] ìš”ì²­ ì²˜ë¦¬ ì „ì— ë¶€ê°€ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ë¯¸ë“¤ì›¨ì–´

# 9.1 ë¯¸ë“¤ì›¨ì–´

- ë¯¸ë“¤ì›¨ì–´(Middleware)ëŠ” ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ì „ì— ìˆ˜í–‰ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ë§í•œë‹¤.

<p align="center">
 <img  src="../../assets/kmj/3/9-1.png" >
  <p align="center"><em> > ì¶œì²˜ : [NestJS ê³µì‹ í™ˆí˜ì´ì§€](https://docs.nestjs.com/middleware)</em></p>
  </p>
 
### âš™ï¸ ë¯¸ë“¤ì›¨ì–´ê°€ ìˆ˜í–‰í•˜ëŠ” ë™ì‘

- ì–´ë–¤ í˜•íƒœì˜ ì½”ë“œë¼ë„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
- ìš”ì²­ê³¼ ì‘ë‹µì— ë³€í˜•ì„ ê°€í•  ìˆ˜ ìˆë‹¤.
- ìš”ì²­/ì‘ë‹µ ì£¼ê¸°ë¥¼ ëë‚¼ ìˆ˜ ìˆë‹¤.
- ì—¬ëŸ¬ ê°œì˜ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ next()ë¡œ í˜¸ì¶œ ìŠ¤íƒìƒ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ì— ì œì–´ê¶Œì„ ì „ë‹¬í•œë‹¤.

> ğŸ’¡ í˜„ì¬ ë¯¸ë“¤ì›¨ì–´ê°€ ì‘ë‹µ ì£¼ê¸°ë¥¼ ëë‚´ì§€ ì•Šì„ ê²ƒì´ë¼ë©´ ë°˜ë“œì‹œ next()ë¥¼ í˜¸ì¶œí•´ì•¼ í•œë‹¤.  
> ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì•„ë¬´ê²ƒë„ í•  ìˆ˜ ì—†ëŠ” ìƒíƒœê°€ ëœë‹¤.

### ğŸŒŸ ë¯¸ë“¤ì›¨ì–´ë¥¼ í™œìš©í•˜ì—¬ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì‘ì—…

- ì¿ í‚¤ íŒŒì‹±
  - ì¿ í‚¤ë¥¼ íŒŒì‹±í•˜ì—¬ ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ ë°ì´í„° êµ¬ì¡°ë¡œ ë³€ê²½.
  - ë¼ìš°í„° í•¸ë“¤ëŸ¬ê°€ ë§¤ë²ˆ ì¿ í‚¤ íŒŒì‹± âŒ
- ì„¸ì…˜ ê´€ë¦¬
  - ì„¸ì…˜ ì¿ í‚¤ë¥¼ ì°¾ì•„ì„œ ì„¸ë…„ì˜ ìƒíƒœë¥¼ ì¡°íšŒí•´ì„œ ìš”ì²­ì— ì„¸ì…˜ ì •ë³´ ì¶”ê°€.
  - ì´ë¥¼ í†µí•´ ë‹¤ë¥¸ í•¸ë“¤ëŸ¬ê°€ ì„¸ì…˜ ê°ì²´ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤.
- ì¸ì¦/ì¸ê°€
  - ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ì— ì ‘ê·¼ ê°€ëŠ¥í•œ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸.
  - NestëŠ” ì¸ê°€ë¥¼ êµ¬í˜„í•  ë•Œ ê°€ë“œë¥¼ ì´ìš©í•˜ë„ë¡ ê¶Œì¥í•œë‹¤.
- ë³¸ë¬¸ íŒŒì‹±
  - POST/PUT ìš”ì²­ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” JSON íƒ€ì…, íŒŒì¼ ìŠ¤íŠ¸ë¦¼ê³¼ ê°™ì€ ë°ì´í„°ë¥¼ ìœ í˜•ì— ë”°ë¼ ì½ê³  í•´ì„í•œ ë‹¤ìŒ ë§¤ê°œë³€ìˆ˜ì— ë„£ëŠ” ì‘ì—….
- ì´ ì™¸ í•„ìš”í•œ ê¸°ëŠ¥ì´ ìˆë‹¤ë©´ ì§ì ‘ êµ¬í˜„ ê°€ëŠ¥.

# 9.2 Logger ë¯¸ë“¤ì›¨ì–´

- ë¯¸ë“¤ì›¨ì–´ëŠ” í•¨ìˆ˜ë¡œ ì‘ì„±í•˜ê±°ë‚˜ `NestMiddleware` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

```tsx
// logger.middleware.ts

import { Injectable, NestMiddleware } from '@nestjs/common';
import { Request, Response, NextFunction } from 'expres';

@Injectable()
export class LoggerMidleware implements NesstMiddleware {
    use(req Request, res: Response, next: NextFunction) {
        // '/users'ë¡œ ìš”ì²­ì´ ë“¤ì–´ì™”ì„ ê²½ìš° ì‹¤í–‰.
        consoole.log('Request...');
        next();
    }
}
```

```tsx
// app.module.ts

import { Module, MiddlewareConsumer, NesstModule } from '@nestjs/common';
import { LoggerMiddleware } from ./logger/logger.middleware';
import { UsersModule } from './users/users.module';

@Module({
  imports: [UsersModule],
})
export class AppModule implements NesstModule {
    // configure í•¨ìˆ˜ë¥¼ í†µí•´ ë¯¸ë“¤ì›¨ì–´ ì„¤ì •.
    configure(consumer: MiddlewareConsumer): any {
        consumer
            // ì‚¬ìš©í•  ë¯¸ë“¤ì›¨ì–´ë¥¼ apply()í•¨ìˆ˜ë¡œ ë“±ë¡
            .apply(LoggerMiddleware)
            // '/users' ê²½ë¡œì—ì„œë§Œ LoggerMiddleware ì‹¤í–‰.
            .forRoutes('/users');
    }
}
```

# 9.3 MiddlewareConsumer

- `MiddlewareConsumer`ëŠ” ì–´ë–¤ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì–´ë””ì— ì ìš©í• ì§€ ê²°ì •í•˜ëŠ” ë„ìš°ë¯¸ ì—­í• ì„ í•œë‹¤.

## apply ë©”ì„œë“œ

1. 1ê°œ ì´ìƒ ë¯¸ë“¤ì›¨ì–´ ì ìš© ë°©ë²•

```tsx
configure(consumer: MiddlewareConsumer): any {
        consumer
            .apply(LoggerMiddleware, Logger2Middleware)
            .forRoutes('/users');
    }
```

1. ë¯¸ë“¤ì›¨ì–´ë¥¼ ì ìš©í•˜ì§€ ì•Šì„ ë¼ìš°íŒ… ê²½ë¡œ ì„¤ì •

```tsx
configure(consumer: MiddlewareConsumer): any {
        consumer
            .apply(LoggerMiddleware, Logger2Middleware)
            .exclude(
        { path: 'auth/login', method: RequestMethod.POST },
        { path: 'auth/register', method: RequestMethod.POST },
      )
      // controller ì§€ì •
            .forRoutes(UsersController);
    }
```

## ğŸ§  í•µì‹¬ ì •ë¦¬

| ê°œë…                 | ì„¤ëª…                                             |
| -------------------- | ------------------------------------------------ |
| `Middleware`         | ìš”ì²­ì´ ì²˜ë¦¬ë˜ê¸° ì „ì— ê±°ì¹˜ëŠ” ì¤‘ê°„ ì²˜ë¦¬ ë‹¨ê³„       |
| `MiddlewareConsumer` | ì–´ë–¤ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì–´ë””ì— ì ìš©í• ì§€ ê²°ì •í•˜ëŠ” ë„ìš°ë¯¸  |
| `apply()`            | "ì´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í• ê²Œìš”!" ë¼ê³  ë§í•˜ëŠ” ë¶€ë¶„     |
| `forRoutes()`        | "ì´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì–´ë–¤ ê²½ë¡œì— ì ìš©í• ì§€" ì •í•˜ëŠ” ë¶€ë¶„ |
